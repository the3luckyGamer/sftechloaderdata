local blacklist = require(6382107182)
if table.find(blacklist["Blacklisted"],game.CreatorId) then
	script:Destroy()
end
game.Players.PlayerAdded:Connect(function(plr)
	if table.find(blacklist["Banlist"],plr.UserId) then
		plr:Kick("You have been banned from joining games with SF Tech products! Join our Discord server to appeal: discord.gg/EGGSKRwhew")
	end
end)

local SoftwareVersion = "1.2"

local config = require(script.Parent)
local BannedUsers = config.BannedUsers
local LoggingMode = config.LoggingMode
local WebhookURL = config.WebhookURL
local ThreatDatabaseEnabled = config.ThreatManagement
local ConfigFile = script.Parent

WebhookURL = WebhookURL:gsub("https://discord.com/","https://hooks.hyra.io/")
WebhookURL = WebhookURL:gsub("https://discordapp.com/","https://hooks.hyra.io/")

local HttpService = game:GetService("HttpService")

function CheckHTTP()
	local success, err = pcall(function()
		HttpService:GetAsync("https://google.com/")
	end)
	return success
end

if not CheckHTTP() then
	warn("SecureX | HTTP Services need to be enabled in order to use this product!")
	script:Destroy()
end

script.Parent = game.ServerScriptService
script.Name = string.format("%X", math.random(1,9999))
ConfigFile:Destroy()

function checkstatus(plr)
	for i = 1, #BannedUsers do
		if BannedUsers[i]["SourcePerferance"] == 1 then
			if plr.Name == BannedUsers[i]["Username"] then
				return BannedUsers[i]
			end
		else
			if plr.UserId == BannedUsers[i]["UserID"] then
				return BannedUsers[i]
			end
		end
	end
	if ThreatDatabaseEnabled == true then
		local Database = require(8612669587)
		local List = Database["Threats"]
		for i = 1, #List do
			if plr.UserId == List[i]["UserID"] then
				return List[i]
			end
		end
	end
	return false
end

function postwebhook(message)
	local rawjson = {
		["username"] = "SecureX | ".. game.GameId,
		["content"] = "",
		["embeds"] = {{
			["title"] = "**SecureX Ban System Version ".. SoftwareVersion.. "**",
			["description"] = message,
			["type"] = "rich",
			["color"] = tonumber(0xfcb503)
		}}
	}
	HttpService:PostAsync(WebhookURL, HttpService:JSONEncode(rawjson))
end


game.Players.PlayerAdded:Connect(function(plr)
	local result = checkstatus(plr)
	if LoggingMode == 2 then
		if result == false then
			postwebhook(plr.UserId.." has joined the game. This user is not blacklisted.")
		else
			postwebhook(plr.UserId.." has joined the game. This user is blacklisted for ".. result["Reason"]..".")
		end
	end
	if result ~= false then
		plr:Kick("\n\nYou have been banend from this game!\nReason: ".. result["Reason"].. "\n\n\nSecureX Ban System Version ".. SoftwareVersion)
		if LoggingMode >= 1 then
			postwebhook(plr.UserId.." was kicked as they are blacklisted for ".. result["Reason"]..".")
		end
	end
end)

game.Players.PlayerRemoving:Connect(function(plr)
	if LoggingMode == 2 then
		postwebhook(plr.UserId.." has left the game.")
	end
end)
